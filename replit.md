# ViVi-Calc - Sales Calculator

## Project Overview
ViVi-Calc is a comprehensive sales calculation tool designed for beauty salons. It helps calculate package deals, discounts, installment payments, and manages client data with different subscription types.

## Recent Changes
- **2025-06-27**: ✅ Исправлено отображение измененных мастером цен услуг - добавлена поддержка editedPrice и customPrice полей
- **2025-06-27**: ✅ Исправлена ошибка PDF скачивания - заменен require на async/await для проверки существования файлов
- **2025-06-27**: ✅ Устранено дублирование продаж в админке - добавлен GROUP BY в SQL запрос для предотвращения дублей
- **2025-06-27**: ✅ Улучшена передача данных о ценах услуг - в service-selector добавлено сохранение как customPrice, так и editedPrice
- **2025-06-27**: ✅ Добавлена возможность удаления продаж в админке - кнопка удаления с подтверждением для каждой продажи
- **2025-06-27**: ✅ Исправлены проблемы с PDF скачиванием - добавлен endpoint для скачивания PDF файлов через API
- **2025-06-27**: ✅ Убраны "Подарочные сеансы" из отображения примененных скидок в детальном просмотре продаж
- **2025-06-27**: ✅ Исправлено отображение цен услуг в админке продаж - теперь показываются реальные цены вместо 0
- **2025-06-27**: ✅ Улучшен внешний вид детального просмотра продаж - добавлены кнопки, улучшена типографика и макет
- **2025-06-27**: ✅ Полностью переработана админка продаж - добавлены поиск, фильтрация, пагинация, детальная информация о каждой продаже в модальном окне
- **2025-06-27**: ✅ Исправлены названия скидок (показываются понятные названия вместо технических), добавлены цены услуг с количеством, email клиентов, ссылки на PDF договоры, процент коррекции
- **2025-06-27**: ✅ Исправлены размеры переключателей "Сертификат" и "Коррекция" - возвращен нормальный размер для удобства использования
- **2025-06-27**: ✅ Оптимизированы блоки левой панели калькулятора для экранов 15" (1920x1080) - уменьшены отступы, шрифты и размеры элементов для компактности
- **2025-06-27**: ✅ Блоки сертификата и коррекции возвращены в исходное расположение - коррекция отдельным блоком под сертификатом
- **2025-06-27**: ✅ Завершена миграция проекта из Replit Agent в среду Replit с настройкой PostgreSQL базы данных
- **2025-06-27**: ✅ Добавлена возможность для мастера изменять стоимость услуг в калькуляторе - мастер может кликнуть на цену услуги и изменить её
- **2025-06-27**: ✅ Исправлен интерфейс редактирования цен: цена возле крестика, убрана иконка карандаша, увеличено поле ввода, автовыделение текста, отключен двойной клик при редактировании, убраны копейки
- **2025-06-27**: ✅ Строка "Сеансы в подарок" и "Подарочные процедуры" теперь отображается только при выборе 10+ процедур на слайдере
- **2025-06-27**: ✅ Исправлена отправка email: заменен "Пакет услуг" на "Услуги:" с перечислением выбранных услуг
- **2025-06-27**: ✅ В PDF убраны строки о бонусном счете и подарочных сеансах для пакета "эконом"
- **2025-06-27**: ✅ Скидка в PDF показывает фактическую величину, а не из настроек пакета
- **2025-06-27**: ✅ Количество сеансов в строке 4 PDF теперь совпадает со строкой 2
- **2025-06-27**: ✅ Добавлена контактная информация клиента в конце PDF документа
- **2025-06-27**: ✅ Исправлено отображение названий услуг в email - теперь корректно передается поле title вместо name
- **2025-06-27**: ✅ Исправлено отображение цвета переключателей "Сертификат" и "Коррекция" - добавлен класс premium в tailwind.config.ts
- **2025-06-27**: ✅ Завершена миграция проекта из Replit Agent в среду Replit с настройкой PostgreSQL базы данных
- **2025-06-26**: ✅ Добавлен информационный блок "Бесплатные зоны" справа от трех блоков сравнения пакетов с единообразным форматированием
- **2025-06-26**: ✅ Оптимизировано модальное окно: убран лишний заголовок, симметричные блоки, компактный размер для ноутбуков
- **2025-06-26**: ✅ Добавлена возможность ввода любой суммы первого взноса ТОЛЬКО для пакета "эконом" когда у клиента нет денег на минимальный платеж
- **2025-06-26**: ✅ Завершена миграция проекта из Replit Agent в среду Replit с настройкой PostgreSQL базы данных
- **2025-06-26**: ✅ ИСПРАВЛЕНА проблема дублирования абонементов - система теперь правильно находит существующие абонементы по услугам и стоимости
- **2025-06-26**: Исправлена генерация PDF договоров-оферт: убран префикс "VV", исправлены значения подарочных сеансов и бонусного счета
- **2025-06-26**: Исправлена валидация пакетов - недоступные пакеты блокируются для выбора, автоматически сбрасывается выбор при недостаточной стоимости курса
- **2025-06-26**: Система поиска дублей работает - успешно найден существующий абонемент "2.576 Верхняя губа, Бикини (тотальное)"
- **2025-06-26**: Обновлена логика поиска в findSubscriptionType для использования данных из balanceContainer
- **2025-06-26**: Добавлено детальное логирование процесса поиска дублей абонементов для отладки
- **2025-06-26**: Успешно завершена миграция проекта из Replit Agent в среду Replit
- **2025-06-26**: Настроена PostgreSQL база данных и применены все необходимые миграции
- **2025-06-26**: Автоматизирована отправка договоров-оферт при создании абонементов
- **2025-06-26**: Убрана отдельная кнопка "Договор-оферта" - теперь отправка происходит автоматически при нажатии "Создать абонемент"
- **2025-06-26**: Добавлено уведомление о статусе отправки договора в интерфейсе успешного создания абонемента
- **2025-06-26**: Переработан формат генерации PDF - теперь создается Приложение №1 в соответствии с образцом
- **2025-06-26**: Настроен Puppeteer для работы с Chromium в среде Replit
- **2025-06-26**: Исправлены ошибки передачи данных между клиентом и сервером для корректной валидации оферт
- **2024-12-27**: Реализована полная система договоров-оферт с генерацией PDF и отправкой email
- **2024-12-27**: Добавлены API endpoints для создания, отправки и управления офертами
- **2024-12-27**: Создан модальный интерфейс для формирования индивидуальных предложений клиентам
- **2024-12-27**: Интегрирована поддержка Nodemailer с Gmail, Yandex и Mail.ru для отправки email
- **2024-12-27**: Добавлен генератор PDF договоров с использованием Puppeteer
- **2024-12-26**: Successfully completed migration from Replit Agent to Replit environment
- **2024-12-26**: Added 5 test services (laser hair removal procedures) and 5 test perks with package configurations
- **2024-12-27**: Added 15 test services (laser hair removal and facial treatments) and 8 test perks with package configurations
- **2024-12-27**: Created complete test dataset with 3 packages (VIP, Standard, Economy) and user accounts
- **2024-12-27**: Updated correction UI to be clickable field with editing state, fixed calculation integration
- **2024-12-27**: Fixed down payment display to show same value across Standard/Economy packages when one is selected
- **2024-12-27**: Added text selection when editing down payment amount for better UX
- **2024-12-27**: Fixed VIP down payment display to show VIP package cost when other packages are selected
- **2024-12-27**: Removed price range text from down payment selection block for cleaner UI
- **2024-12-27**: Changed monthly payment calculation to use minimum installment months (2) instead of maximum
- **2024-12-27**: Removed package pricing text display from promo-calculator payment section
- **2024-12-27**: Successfully completed migration from Replit Agent to Replit environment
- **2024-12-27**: Fixed calculatorSettings error in ThreeBlockComparison component 
- **2024-12-27**: Added 5 test services (laser hair removal) and 5 test perks with package configurations
- **2024-12-27**: Убраны все закругления, создан оптимальный компактный дизайн для 15" экранов
- **2024-12-27**: Optimized spacing for 15" 1920x1080 screens - reduced gaps between blocks for better fit
- **2024-12-27**: Added 5 test services and 5 test perks during Replit environment migration
- **2024-12-26**: Оптимизированы левые блоки: применена компактность и небольшие закругления (4px)
- **2024-12-26**: Убраны все закругления, создан оптимальный компактный дизайн для 15" экранов
- **2024-12-26**: Добавлена адаптивность: компактный вид для 15" экранов, обычный для больших мониторов
- **2024-12-26**: Применена компактная оптимизация для размещения на экране 1920x1080 без прокрутки
- **2024-12-26**: Убраны подчеркивания, закругления снизу у блоков и вынесены строки платежей за блоки
- **2024-12-26**: Увеличена прозрачность рамок до 50% и изменены синие подчеркивания на розовые
- **2024-12-26**: Изменен цвет рамок блоков на розовый с прозрачностью для гармоничного дизайна
- **2024-12-26**: Added 10 test services and 8 test perks with package configurations
- **2024-12-26**: Migration from Replit Agent to Replit completed with test data
- **2024-12-26**: Added 10 test services for laser hair removal procedures
- **2024-12-26**: Added 8 test perks with package-specific values for all three packages
- **2024-12-26**: Successfully completed migration from Replit Agent to Replit environment
- **2024-12-26**: Redesigned package comparison into three modern curved blocks with SVG borders
- **2024-12-26**: Implemented all original table elements: perks, gift sessions, discounts, bonus accounts
- **2024-12-26**: Fixed gift calculations using proper cost-of-one-visit logic from original component
- **2024-12-26**: Added package selection inside advantages block with smaller, cleaner design
- **2024-12-26**: Used modern SVG masking for elegant title cutouts in block borders
- **2024-12-26**: Added test services (10) and perks (8) with complete package value configurations
- **2024-12-24**: Successfully completed migration from Replit Agent to Replit environment
- **2024-12-24**: Added 10 test services for laser hair removal procedures
- **2024-12-24**: Added 5 test perks with package-specific values for VIP, Standard, and Economy packages
- **2024-12-24**: Fixed certificate toggle color from purple to premium pink theme
- **2024-12-24**: Added 5 test services and 5 test perks to database
- **2024-12-23**: Successfully migrated project from Replit Agent to Replit environment
- **2024-12-23**: Set up PostgreSQL database with all required tables
- **2024-12-23**: Added test data: 10 services and 5 perks with package configurations
- **2024-12-23**: Removed gray background from calculator page per user request
- **2024-12-23**: Applied basic visual separation using card borders to distinguish components from white background
- **2024-12-23**: Fixed missing borders on all UI blocks in both calculator and promo-calculator pages
- **2024-12-23**: Removed gray background from package comparison table header for consistent white design
- **2024-12-23**: Application running successfully on port 5000 - migration and styling complete
- **2024-12-23**: Fixed gift services cost calculation to use original cost per procedure instead of discounted cost
- **2024-12-23**: Fixed gift services calculation to use database settings (giftSessions) and update properly when procedure count changes
- **2024-12-23**: Fixed gift calculation to use correct formula: baseCost ÷ totalProcedures × giftSessions
- **2024-12-23**: Gift calculation now properly calculates cost per procedure and multiplies by database gift sessions setting
- **2024-12-23**: Fixed gift calculation to be independent of procedure count slider - now uses totalProcedures from calculation for stable gift values
- **2024-12-23**: Final fix for gift calculation - now uses simple formula: sum of selected services base costs × gift sessions from package settings

## Project Architecture
- **Frontend**: React with Vite, TailwindCSS, Radix UI components
- **Backend**: Express.js with TypeScript
- **Database**: PostgreSQL (Neon) with Drizzle ORM
- **Authentication**: PIN-based system with roles (master/admin)
- **Key Features**:
  - Package calculation (VIP, Standard, Economy)
  - Service selection and pricing
  - Installment payment calculations
  - Client management
  - Sales tracking
  - Configurable perks and discounts
  - Contract offers generation and email delivery
  - PDF generation for individual client proposals
  - Multi-provider email support (Gmail, Yandex, Mail.ru)
  - Payment schedule automation

## User Preferences
- Language: Russian
- Prefers test data without icons in names or descriptions
- Wants 5 perks without highlighting features
- Prefers clean white background on calculator page (no gray backgrounds)
- Wants simple visual separation with borders, no complex hover effects or gradients

## Development Notes
- Uses TSX for TypeScript execution
- Database migrations handled via Drizzle Kit
- Environment configured for Replit deployment
- Client/server separation maintained for security